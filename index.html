<!DOCTYPE html>
<html>
  <head>
    <title><%= productName %></title>

    <meta charset="utf-8" />
    <meta name="description" content="<%= productDescription %>" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta
      name="viewport"
      content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width<% if (ctx.mode.cordova || ctx.mode.capacitor) { %>, viewport-fit=cover<% } %>"
    />

    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png" />
    <link rel="manifest" href="icons/site.webmanifest" />
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5" />
    <link rel="shortcut icon" href="favicon.ico" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="msapplication-config" content="icons/browserconfig.xml" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="icon" type="image/ico" href="favicon.ico" />

    <style>
      #index--app-loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #ffffff;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      }

      .index--spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #1976d2;
        border-radius: 50%;
        animation: index--spin 1s linear infinite;
        margin-bottom: 20px;
      }

      @keyframes index--spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .index--loading-text {
        color: #666;
        font-size: 16px;
        margin-bottom: 10px;
      }

      .index--error-container {
        text-align: center;
        max-width: 400px;
        padding: 20px;
      }

      .index--error-title {
        color: #d32f2f;
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 15px;
      }

      .index--error-message {
        color: #666;
        font-size: 14px;
        margin-bottom: 20px;
        line-height: 1.5;
      }

      .index--reload-button {
        background: #1976d2;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .index--reload-button:hover {
        background: #1565c0;
      }

      .index--hidden {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div id="index--app-loading" class="index--hidden">
      <div class="index--spinner"></div>
      <div class="index--loading-text">Loading Libre Money...</div>

      <div class="index--error-container index--hidden" id="index--error-container">
        <div class="index--error-title">Timed Out</div>
        <div class="index--error-message">
          The application is taking longer than expected to load. This might be due to a slow connection or a temporary issue.
        </div>
        <button class="index--reload-button" onclick="reloadApplication()">Reload Application</button>
      </div>
    </div>

    <script src="pouchdb_8_0_1.min.js"></script>
    <script src="pouchdb_8_0_1.find.min.js"></script>
    <script type="text/javascript">
      const appLoading = document.getElementById("index--app-loading");
      const errorContainer = document.getElementById("index--error-container");
      const spinner = document.querySelector(".index--spinner");
      const loadingText = document.querySelector(".index--loading-text");

      const LOADING_APPEAR_DELAY = 1_000; // 1 second
      const ERROR_DISPLAY_DELAY = 10_000; // 10 seconds
      const POLL_INTERVAL = 10;

      function showLoading() {
        if (appLoading) {
          appLoading.classList.remove("index--hidden");
        }
      }

      function hideLoading() {
        if (appLoading) {
          appLoading.classList.add("index--hidden");
        }
      }

      function showError() {
        if (errorContainer) {
          errorContainer.classList.remove("index--hidden");
        }
        if (loadingText) {
          loadingText.style.display = "none";
        }
      }

      let loadingIntervalId = null;
      let showLoadingTimeoutId = null;
      let showErrorTimeoutId = null;

      function checkIfAppLoaded() {
        return window.__ck__hasLoaded;
      }

      loadingIntervalId = setInterval(() => {
        // If app is loaded, stop polling and hide loading
        if (checkIfAppLoaded()) {
          clearInterval(loadingIntervalId);
          clearTimeout(showLoadingTimeoutId);
          clearTimeout(showErrorTimeoutId);
          hideLoading();
        }
      }, POLL_INTERVAL);

      showLoadingTimeoutId = setTimeout(() => {
        showLoading();
      }, LOADING_APPEAR_DELAY);

      showErrorTimeoutId = setTimeout(() => {
        showError();
      }, ERROR_DISPLAY_DELAY);

      function reloadApplication() {
        window.location.href = "/";
        window.location.reload(true);
      }
    </script>
    <!-- quasar:entry-point -->
  </body>
</html>
